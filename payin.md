# payin

Модель **payin** обрабатывает входящие платежи и в первую очередь предназначена для пополнения балансов мерчанта собственными средствами.

В модели не предусмотрена возможность доплаты, возврата. Сумма платежа сразу и в полном объеме, за вычетом комиссий, зачисляется на баланс мерчанта.

Комиссию за транзакцию платежа типа **payin** оплачивает мерчант.

Используя методы модели **payin** мерчант может:

1. Создать ордер входящего платежа - метод [payin.create](payin.md#payin_create)  
2. Рассчитать предварительные параметры входящего платежа - метод [payin.calc](payin.md#payin_calc)
3. Получить параметры ранее созданного ордера входящего платежа - метод [payin.get](payin.md#payin_get)

## payin.create

Метод для создания ордера входящего платежа \(типа **payin**\).

Если в запросе не передано наименование валюты зачисления \(**out\_curr**\), то будет произведено начисление на баланс валюты пополнения \(**in\_curr**\).  
Если в запросе были передан параметр **code** _И_ наименование платёжной системы соответствует кодовой ПС, то будет создан ордер типа **payin** c заявленными параметрами.  
В противном случае будет создан ордер типа **invoice**, в котором будут использованы переданные параметры, а в репрезентации его данных заполнено поле **paylink** и другие, характерные для ордеров типа _\*invoice_.\*

Во входных данных метода в зависимости от используемой платежной системы \(**payway**\) в запросе **необходимо** передать следующие параметры:

??? abstract "Входящие параметры метода"

| param | required | example | description |
| ---: | :---: | :--- | :--- |
| amount | yes | "256,13" | сумма входящего платежа \(в валюте пополнения\) |
| callback\_url | no | "[https://any\_money.redirect.com](https://any_money.redirect.com)" | url-адрес для уведомлений про изменения состояния ордера,  [формат уведомлений](anymoney_partner_docs-master/docs/Archive/add_order.md#order_repr) |
| code | no | "353455346346636" | полный номер кода внешней ПС |
| externalid | yes | "123" | уникальный идентификатор, заданный мерчантом |
| in\_curr | yes | "UAH" | валюта пополнения |
| out\_curr | no | "GBP" | валюта зачисления |
| payway | yes | "anycash" | направление платежа \(платежная система\) |

??? info "Обязательные параметры для указанных платёжных систем"  **qiwi** **exmo, kuna, anycash** &lt;/dd&gt;

!!! warning "Внимание!" Для типизированных мерчантов передаваемая платежная система должна совпадать с типом мерчанта, а значение **out\_curr** должно быть равно **in\_curr** или отсутствовать, иначе будут возвращены ошибки

!!! success "Данные ответа метода" [репрезентация ордера](anymoney_partner_docs-master/docs/add_order.md)

??? failure "Возможные возвращаемые ошибки" **EParamAmountFormatInvalid**переданная сумма не соответствует параметрам валюты, например, не соответствует дробная часть**EParamAmountTooBig**\*\*amount\*\* больше максимальной суммы операции**EParamAmountTooSmall**\*\*amount\*\* меньше минимальной суммы операции**EParamCodeInvalid**переданный \*\*code\*\* невалиден для переданной \*\*payway\*\***EParamCurrencyInvalid**валюта отсутствует в системе Any.Money**EParamFieldInvalid**передан невалидный параметр \*\*callback\_url\*\***EParamInvalid**

## payin.calc

Метод расчета параметров входящего платежа с учётом суммы зачисления.

Если в запросе не передано значение валюты зачисления \(параметр **out\_curr**\), то оно будет взято равным названию валюты пополнения \(**in\_curr**\).

??? abstract "Входящие параметры метода"

| param | required | example | description |
| ---: | :---: | :--- | :--- |
| amount | yes | "4000" | сумма входящего платежа \(в валюте пополнения\) |
| in\_curr | yes | "RUB" | валюта пополнения |
| out\_curr | no | "UAH" | валюта зачисления |
| payway | yes | "anycash" | платежная система, через которую ожидается пополнение |

!!! warning "Внимание!" Для типизированных мерчантов передаваемая платежная система должна совпадать с типом мерчанта, а значение **out\_curr** должно быть равно **in\_curr** или отсутствовать, иначе будут возвращены ошибки

!!! success "Данные ответа метода" Параметры транзакции зачисления **account\_amount**сумма зачисления, за вычетом комиссии**in\_amount**сумма поступления в Any.Money**in\_fee\_amount**сумма комиссии в валюте пополнения**orig\_amount**сумма, которая была задана при создании ордера**out\_amount**сумма, зачисленная на баланс мерчанта**out\_fee\_amount**сумма комиссии**rate**курс обмена валют, если проводилась конвертация. В формате \`"rate": \["25.30301", "1"\]\`

??? failure "Возможные возвращаемые ошибки" **EParamAmountFormatInvalid**переданная сумма не соответствует параметрам валюты, например, не соответствует дробная часть**EParamAmountTooBig**обрабатываемая сумма больше максимальной суммы операции**EParamAmountTooSmall**обрабатываемая сумма меньше минимальной суммы операции**EParamCurrencyInvalid**валюта отсутствует в системе Any.Money**EParamInvalid**

## payin.get

Метод поиска и получения параметров уже существующего в системе ордера платежа пополнения по его внешнему идентификатору.

??? abstract "Входящие параметры метода"

| param | required | example | description |
| ---: | :---: | :--- | :--- |
| externalid | yes | "123" | уникальный идентификатор, переданный мерчантом |

!!! success "Данные ответа метода" [репрезентация ордера](anymoney_partner_docs-master/docs/add_order.md) входящего платежа

??? failure "Возможные возвращаемые ошибки" **EParamInvalid**передано неверное значение параметра \*\*externalid\*\***EParamNotFound**не найден ордер c соответствующим \*\*externalid\*\***EParamType**формат переданного \*\*externalid\*\* не соответствует ожидаемому

