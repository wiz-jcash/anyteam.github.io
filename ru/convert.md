# convert

Используя методы модели **convert** мерчант может:

1. Провести конвертацию валют - [convert.create](convert.md#convert_create)
2. Предварительно рассчитать параметры конвертации - [convert.calc](convert.md#convert_calc)
3. Получить информацию по интересующей его операции конвертации - [convert.get](convert.md#convert_get)

!!! warning "Внимание!" Методы модели заблокированы для типизированных мерчантов, при попытке использовать методы модели **convert** для **типизированных мерчантов** Система возвратит ошибку **EStateForbidden**.

## endpoint

Запросы на работу методов модели отправляются на endpoint **`https://api.any.money/`**.

## convert.create

Метод создает ордер конвертации переданной пары валют и возвращает репрезентацию параметров операции.

??? abstract "Входящие параметры метода"

| param | required | example | description |
| ---: | :---: | :--- | :--- |
| callback\_url | no | "[https://any\_money.redirect.com](https://any_money.redirect.com)" | url-адрес для уведомлений об изменении состояния ордера,  [формат уведомлений](add_order.md#order_repr) |
| externalid | yes | "123" | идентификатор, заданный мерчантом |
| in\_amount | yes\* | "2345" | сумма списания |
| in\_curr | yes | "RUB" | валюта списания |
| out\_amount | yes\* | "345" | сумма зачисления |
| out\_curr | yes | "UAH" | валюта зачисления |

```text
\* обязательно указать один из параметров **in_amount** или **out_amount**
```

!!! success "Данные ответа метода" [репрезентация ордера](add_order.md) операции типа **convert**

??? failure "Возможные возвращаемые ошибки" **EParamAmountFormatInvalid**переданная сумма не соответствует параметрам валюты, например, не соответствует дробная часть**EParamAmountTooBig**обрабатываемая сумма больше максимальной суммы конвертации**EParamAmountTooSmall**обрабатываемая сумма меньше минимальной суммы конвертации**EParamCurrencyInvalid**валюта отсутствует в системе**EParamFieldInvalid**передан невалидный параметр \*\*callback\_url\*\***EParamInvalid**переданы неверные значения \*\*in\_amount\*\*, \*\*out\_amount\*\*, не передан ни один из \*\*in\_amount\*\*, \*\*out\_amount\*\* или переданы сразу оба**EParamUnique**ордер с таким значением \*\*externalid\*\* уже существует**EStateCurrencyInactive**валюта с переданным именем \*\*in\_curr\*\*, \*\*out\_curr\*\* не активна\(отключена\)**EStateExchangeUnavail**\*\*in\_curr\*\* и \*\*out\_curr\*\* совпадают или данное направление обмена недоступно**EStateForbidden**попытка использования метода для типизированного мерчанта**EStateInsufficientFunds**обрабатываемая сумма больше баланса мерчанта в валюте списания

## convert.calc

Метод расчета параметров ордера конвертации с учетом суммы и валют транзакции.

??? abstract "Входящие параметры метода"

| param | required | example | description |
| ---: | :---: | :--- | :--- |
| in\_amount | yes\* | "100" | сумма списания |
| in\_curr | yes | "RUB" | валюта списания |
| out\_amount | yes\* | "100" | сумма зачисления |
| out\_curr | yes | "USD" | валюта зачисления |
| validate\_balance | no | true | ключ необходимости проверки достаточности суммы на балансе валюты списания для выполнения данной транзакции \(**true**=проверка нужна, **false**=нет\). default=**true** |

```text
\* обязательно указать один из параметров **in_amount** или **out_amount**
```

!!! success "Данные ответа метода" Параметры ордера типа **convert** **account\_amount**сумма изменения баланса мерчанта \(для методов типа \*\*convert\*\* всегда строго равна нулю\)**in\_amount**сумма валюты списания, необходимая для конвертации**orig\_amount**оригинальная сумма, т.е. тот \*\*amount\*\* списания или зачисления, который был заказан при создании ордера**out\_amount**сумма валюты зачисления, получившаяся в результате конвертации**rate**курс обмена валют, если проводилась конвертация. В формате \`"rate": \["25.30301", "1"\]\`

??? failure "Возможные возвращаемые ошибки" **EParamAmountFormatInvalid**переданная сумма не соответствует параметрам валюты, например, не соответствует дробная часть**EParamAmountTooBig**обрабатываемая сумма больше максимальной суммы конвертации**EParamAmountTooSmall**обрабатываемая сумма меньше минимальной суммы конвертации**EParamCurrencyInvalid**валюта \*\*in\_curr\*\* и/или \*\*out\_curr\*\* отсутствует в системе**EParamInvalid**переданы неверные значения \*\*in\_amount\*\*, \*\*out\_amount\*\*, не передан ни один из \*\*in\_amount\*\*, \*\*out\_amount\*\* или переданы сразу оба**EStateCurrencyInactive**валюта с переданным именем \*\*in\_curr\*\*, \*\*out\_curr\*\* не активна**EStateExchangeUnavail**\*\*in\_curr\*\* и \*\*out\_curr\*\* совпадают или данное направление обмена недоступно**EStateForbidden**попытка использования метода для типизированного мерчанта**EStateInsufficientFunds**обрабатываемая сумма больше чем баланс мерчанта в валюте зачисления

## convert.get

Метод поиска и получения параметров ордера типа **convert** \(обмена валют\) по его идентификатору.

??? abstract "Входящий параметр метода"

| param | required | example | description |
| ---: | :---: | :--- | :--- |
| externalid | yes | "123" | внешний идентификатор ордера типа **convert** |

!!! success "Данные ответа метода" [репрезентация ордера](add_order.md)

??? failure "Возможные возвращаемые ошибки" **EParamInvalid**передано неверное значение параметра \*\*externalid\*\***EParamNotFound**не найден ордер c соответствующим \*\*externalid\*\***EStateForbidden**попытка использования метода для типизированного мерчанта

